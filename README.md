# RISC-V 单周期 CPU 实现

## 项目概述

这是一个完整的 RISC-V RV32I 基本指令集单周期 CPU 实现，支持所有 37 条基本指令。项目采用 Verilog HDL 编写，包含详细的中文注释，适合学习和教学使用。

## 支持的指令集

### RV32I 基本指令集 (37 条指令)

#### U 型指令 (2 条)

- **LUI** - 加载高位立即数：将 20 位立即数左移 12 位后存入目标寄存器
- **AUIPC** - PC 相对高位立即数：将 20 位立即数左移 12 位后与 PC 相加，结果存入目标寄存器

#### J 型指令 (1 条)

- **JAL** - 无条件跳转并链接：计算跳转目标地址，将当前 PC+4 存入目标寄存器，然后跳转

#### I 型指令 (19 条)

- **JALR** - 寄存器跳转并链接：计算跳转目标地址(rs1+立即数)，将当前 PC+4 存入目标寄存器，然后跳转
- **ADDI** - 立即数加法：rs1 + 符号扩展的 12 位立即数
- **SLTI** - 立即数有符号比较：rs1 < 立即数 ? 1 : 0
- **SLTIU** - 立即数无符号比较：rs1 < 立即数 ? 1 : 0
- **XORI** - 立即数异或：rs1 ^ 立即数
- **ORI** - 立即数或：rs1 | 立即数
- **ANDI** - 立即数与：rs1 & 立即数
- **SLLI** - 立即数逻辑左移：rs1 << shamt
- **SRLI** - 立即数逻辑右移：rs1 >> shamt
- **SRAI** - 立即数算术右移：rs1 >>> shamt
- **LB** - 字节加载（有符号扩展）
- **LH** - 半字加载（有符号扩展）
- **LW** - 字加载
- **LBU** - 字节加载（无符号扩展）
- **LHU** - 半字加载（无符号扩展）

#### S 型指令 (3 条)

- **SB** - 字节存储：将 rs2 的低 8 位存储到内存
- **SH** - 半字存储：将 rs2 的低 16 位存储到内存
- **SW** - 字存储：将 rs2 的 32 位存储到内存

#### B 型指令 (6 条)

- **BEQ** - 相等分支：rs1 == rs2 时跳转
- **BNE** - 不等分支：rs1 != rs2 时跳转
- **BLT** - 有符号小于分支：rs1 < rs2 时跳转
- **BGE** - 有符号大于等于分支：rs1 >= rs2 时跳转
- **BLTU** - 无符号小于分支：rs1 < rs2 时跳转
- **BGEU** - 无符号大于等于分支：rs1 >= rs2 时跳转

#### R 型指令 (6 条)

- **ADD** - 加法：rs1 + rs2
- **SUB** - 减法：rs1 - rs2
- **SLL** - 逻辑左移：rs1 << rs2[4:0]
- **SLT** - 有符号比较：rs1 < rs2 ? 1 : 0
- **SLTU** - 无符号比较：rs1 < rs2 ? 1 : 0
- **XOR** - 异或：rs1 ^ rs2
- **SRL** - 逻辑右移：rs1 >> rs2[4:0]
- **SRA** - 算术右移：rs1 >>> rs2[4:0]
- **OR** - 或：rs1 | rs2
- **AND** - 与：rs1 & rs2

## 项目结构

```
PipelineCPU/
├── src/
│   ├── ctrl_encode_def.v      # 控制信号定义
│   ├── ctrl.v                 # 控制单元
│   ├── alu.v                  # 算术逻辑单元
│   ├── EXT.v                  # 立即数扩展单元
│   ├── dm.v                   # 数据内存
│   ├── im.v                   # 指令内存
│   ├── PC.v                   # 程序计数器
│   ├── NPC.v                  # 下一条PC计算
│   ├── RF.v                   # 寄存器文件
│   ├── SCPU.v                 # 单周期CPU主模块
│   ├── sccomp.v               # 顶层模块
│   ├── sccomp_tb.v            # 测试台
│   ├── Test_8_Instr.asm       # 原始测试程序
│   ├── Test_8_Instr.dat       # 原始测试数据
│   └── Test_All_RV32I.asm     # 完整指令集测试程序
├── RISCV指令.md               # RISC-V指令集说明文档
└── README.md                  # 项目说明文档
```

## 主要模块说明

### 1. 控制单元 (ctrl.v)

- 负责指令解码和控制信号生成
- 支持所有 RV32I 指令的识别
- 生成 ALU 操作码、内存控制信号、寄存器控制信号等

### 2. 算术逻辑单元 (alu.v)

- 实现所有 RV32I 指令的 ALU 操作
- 支持算术运算、逻辑运算、比较运算、移位运算
- 生成零标志位用于分支判断

### 3. 立即数扩展单元 (EXT.v)

- 处理不同指令格式的立即数扩展
- 支持 I 型、S 型、B 型、U 型、J 型指令的立即数处理
- 实现符号扩展和零扩展

### 4. 数据内存 (dm.v)

- 支持字节、半字、字访问
- 支持有符号和无符号加载操作
- 实现不同大小的存储操作

### 5. 寄存器文件 (RF.v)

- 32 个 32 位通用寄存器
- 支持双端口读取和单端口写入
- 包含调试接口

## 使用方法

### 1. 仿真环境要求

- ModelSim/QuestaSim
- 或其他支持 Verilog 的仿真工具

### 2. 编译和仿真

```bash
# 编译所有Verilog文件
vlog *.v

# 启动仿真
vsim sccomp_tb

# 运行仿真
run -all
```

### 3. 测试程序

项目包含两个测试程序：

- `Test_8_Instr.asm` - 原始 8 条指令测试
- `Test_All_RV32I.asm` - 完整 RV32I 指令集测试

### 4. 结果查看

仿真完成后，查看 `results.txt` 文件获取详细的寄存器状态信息。

## 设计特点

1. **完整性**：支持完整的 RV32I 基本指令集
2. **可读性**：所有代码都包含详细的中文注释
3. **模块化**：采用模块化设计，便于理解和维护
4. **可扩展性**：易于扩展支持更多指令集
5. **教学友好**：适合计算机组成原理课程教学

## 技术规格

- **指令集**：RV32I 基本指令集
- **数据宽度**：32 位
- **寄存器数量**：32 个通用寄存器
- **内存模型**：哈佛架构（指令内存和数据内存分离）
- **寻址方式**：支持立即数、寄存器、基址+偏移量寻址

## 注意事项

1. 本项目为教学用途，未实现异常处理和中断机制
2. 内存访问未实现对齐检查
3. 建议在仿真环境中使用，实际硬件实现需要额外的时序约束

## 贡献

欢迎提交问题报告和改进建议！

## 许可证

本项目仅供学习和教学使用。
